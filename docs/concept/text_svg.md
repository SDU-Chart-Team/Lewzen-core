# 文本矢量图

## 文本元素`TextElement`

维护纯文本中的单个字符及其样式，并根据规则生成图形

- 继承自`SVGElement`

### 成员

- 文本字符`TextContent`

  纯文本源代码拆分后得到的单个纯文本字符；或者代表markdown/katex语法的字符串

- 填充样式`FillStyle`、

  - 字体（填充）颜色

- 线条样式`StrokeStyle`

  - 字体边缘颜色、宽度

- 文本样式`TextStyle`

  - 字体大小
  - 字体
  - 特殊样式（加粗、下划线、斜体等）
  - 对齐方式
  - 段落样式（标题、正文）

- 解析器`TextParser`

  描述文本类型、提供解析方法

### 接口

- 生成SVG XML
- 修改填充样式
- 修改线条样式
- 修改字体样式

## 文本类Text

表示文本的类，根据文本源代码解析生成基于文本矢量图

- 根据文本类型决定解析方式

  当文本类型为纯文本时，将文本拆分为字符并生成`TextElement`；当文本类型为markdown/katex时，不进行拆分，生成单个`TextElement`

- 维护文本源代码、文本类型、样式及其解析方法

### 成员

- 文本源代码`SourceCode`

- 文本元素列表 `TextElementList`

- 文本类型

- 文本样式表

  - 对于纯文本，包含每个文本字符的样式
  - 对于markdown/katex，存在唯一样式
  
- SVG生成器 `SVGGenerator`

  

### 接口

- 创建过程

  创建对象时传入文本源代码，然后根据文本源代码生成文本元素列表

- 获取到文本源代码并修改

  修改后，重新生成文本元素列表

- 修改样式

  修改样式定义
  
- 生成SVG

  生成包含外接矩形框的文本SVG

### 子类

继承自文本类的特殊文本类型

| 文本类型     | 说明                                |
| ------------ | ----------------------------------- |
| 纯文本       | 所见即所得的纯文本字符串            |
| markdown语句 | 以markdown语法定义的特殊文本字符串  |
| katex公式    | 以latex公式语法定义的特殊文本字符串 |

## 文本矢量图类TextSVG

使用组件坐标系的矢量图，是文本的装饰器

- 将文本映射到组件坐标系
- 文本框

### 成员

- 文本 `Text`

- 坐标映射

  标记文本在组件坐标系中的位置。通过记录文本坐标系原点在组件坐标系中的位置，将基于文本坐标系的SVG映射到组件坐标系中。

  考虑到一个组件中可以插入多个文本，同一个组件每个文本矢量图的坐标原点应当彼此不同。

  - 成员

    组件相对坐标系原点

### 接口

- 创建过程

  构造对象的过程

  - 坐标初始化过程

    在创建文本框时确定文本框在画布坐标系中的坐标

  - 元素初始化过程

    在输入文本内容结束后。创建文本`Text`对象

- 检测坐标是否在文本外接矩形框内，从而选定文本并修改

- 更新

  对文本进行更新，重新生成文本对象，然后获取到新的SVGXML

## 组件文本矢量图类ComponentTextSVG

使用画布坐标系的文本矢量图。以组件坐标系的原点及两条坐标轴构建文本的外接矩形框。

- 将一个或多个文本矢量图封装进外接矩形框中，并构成组件
- 将组件根据布局映射到画布坐标系中

### 成员

- 文本矢量图集合

- 布局

  描述文本组件如何呈现在画布上。

  - 基于文本的外接矩形描述文本矢量图

  - 组件坐标系到画布坐标系的映射
  - 文本组件的位置修改、旋转

### 接口

- 获取到特定文本，从而对其进行更新
  - 当获取到画布上一个点的坐标时，首先判断是否存在于当前文本组件的范围中；若是，则进一步计算该坐标点属于哪个文本矢量图

- 更新

  更新布局时，重新生成SVGXML

- 绘制

  文本矢量图完成绘制后，将文本矢量图按照布局进行变换，映射到画布坐标系。
